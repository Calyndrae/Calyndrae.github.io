<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JD | 项目集合</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        background: '#0a0b10',
                        surface: 'rgba(255, 255, 255, 0.02)', 
                        borderLight: 'rgba(255, 255, 255, 0.06)',
                        textMuted: '#8b8e98',
                        accentBlue: '#3b82f6',
                        accentPurple: '#a855f7',
                        accentPink: '#ec4899'
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #0a0b10; color: #ffffff; overflow-x: hidden; -webkit-font-smoothing: antialiased; }
        ::-webkit-scrollbar { width: 0px; background: transparent; }

        .glow-blob { position: fixed; border-radius: 50%; filter: blur(140px); z-index: -1; opacity: 0.5; pointer-events: none; }
        .glow-purple { top: 0%; left: 20%; width: 600px; height: 600px; background: rgba(168, 85, 247, 0.3); }
        .glow-blue { bottom: 0%; right: 10%; width: 700px; height: 700px; background: rgba(59, 130, 246, 0.25); }

        .glass-card {
            background: linear-gradient(145deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%);
            border: 1px solid var(--borderLight);
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.05), 0 20px 40px -10px rgba(0,0,0,0.5);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .glass-card:hover { 
            transform: translateY(-4px); 
            background: linear-gradient(145deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.02) 100%); 
            border-color: rgba(255,255,255,0.15); 
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.1), 0 30px 50px -15px rgba(0,0,0,0.7); 
        }

        .glass-card.latest-project {
            border: 1px solid rgba(168, 85, 247, 0.4);
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.1), 0 0 40px rgba(168, 85, 247, 0.15);
        }
        .glass-card.latest-project:hover { box-shadow: inset 0 1px 0 rgba(255,255,255,0.1), 0 0 60px rgba(168, 85, 247, 0.3); }

        /* 隐藏滚动条 */
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }

        /* 底部模糊渐变遮罩层 */
        .blur-overlay {
            position: absolute;
            bottom: 0; left: 0; right: 0;
            height: 60px;
            background: linear-gradient(to bottom, transparent, #0a0b10);
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .text-gradient { background: linear-gradient(135deg, #ffffff 0%, #a855f7 50%, #3b82f6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* Loading 动画 */
        .loader { border-top-color: #a855f7; -webkit-animation: spinner 1.5s linear infinite; animation: spinner 1.5s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="relative min-h-screen flex flex-col">

    <div class="glow-blob glow-purple"></div>
    <div class="glow-blob glow-blue"></div>

    <nav class="fixed top-0 w-full z-50 px-8 py-5 flex justify-between items-center max-w-[1440px] mx-auto left-0 right-0 backdrop-blur-md bg-background/50 border-b border-borderLight">
        <a href="index.html" class="flex items-center space-x-3 group">
            <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-accentBlue to-accentPurple flex items-center justify-center shadow-[0_0_15px_rgba(168,85,247,0.5)]">
                <div class="w-3 h-3 rounded-full bg-background"></div>
            </div>
            <span class="text-xl font-bold tracking-widest text-white">JD<span class="text-accentPurple">.</span></span>
        </a>

        <div class="hidden md:flex space-x-10 text-sm font-semibold text-textMuted tracking-wide">
            <a href="index.html" class="hover:text-white transition-colors">Home</a>
            <a href="about.html" class="hover:text-white transition-colors">About</a>
            <a href="projects.html" class="text-white relative after:content-[''] after:absolute after:-bottom-2 after:left-0 after:w-full after:h-0.5 after:bg-white">Projects</a>
            <a href="posts.html" class="hover:text-white transition-colors">Posts</a>
        </div>
    </nav>

    <main class="flex-grow max-w-[1200px] mx-auto w-full px-8 pt-40 pb-32">
        <h1 class="text-5xl md:text-7xl font-bold tracking-tight mb-6 gs-reveal">Selected <span class="text-gradient">Work.</span></h1>
        <p class="text-xl text-textMuted mb-16 max-w-2xl gs-reveal">实时从 GitHub 同步数据。系统自动读取 txt，识别最新日期霸占主位，过长文本支持自动模糊渐现。</p>

        <div id="loading-state" class="flex flex-col items-center justify-center py-20">
            <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-800 h-12 w-12 mb-4"></div>
            <p class="text-textMuted font-mono text-sm tracking-widest uppercase">Fetching GitHub DB...</p>
        </div>

        <div id="dynamic-projects-grid" class="grid grid-cols-1 md:grid-cols-2 gap-8 hidden"></div>
    </main>

    <footer class="border-t border-borderLight bg-black/50 backdrop-blur-lg py-8 text-center text-xs text-textMuted mt-auto">
        <p>© 2026 JD. Data driven. <a href="https://github.com" class="hover:text-white ml-2 underline decoration-white/20">GitHub</a></p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script>
        // ==========================================
        // GitHub TXT 数据库请求与解析逻辑
        // ==========================================
        const DB_URL = "https://raw.githubusercontent.com/Calyndrae/calyndrae.github.io/refs/heads/main/projects/projects.txt";

        document.addEventListener("DOMContentLoaded", () => {
            fetchProjectsData();
        });

        async function fetchProjectsData() {
            try {
                // 加时间戳防止 GitHub CDN 强缓存，保证你改了 txt 刷新页面就能看到
                const response = await fetch(`${DB_URL}?t=${new Date().getTime()}`);
                if (!response.ok) throw new Error("TXT file not found or inaccessible.");
                
                const rawText = await response.text();
                parseAndRender(rawText);
            } catch (error) {
                console.error("Failed to load DB:", error);
                document.getElementById('loading-state').innerHTML = `
                    <p class="text-red-500 font-bold">Error connecting to GitHub Database.</p>
                    <p class="text-textMuted text-sm mt-2">确保你在 GitHub 创建了 <code>projects/projects.txt</code></p>
                `;
            }
        }

        function parseAndRender(rawText) {
            // 利用正则拆分块 (以 "** " 为分隔符开始切片)
            const blocks = rawText.split(/\*\*\s*/).filter(b => b.trim().length > 0);
            const projects = [];

            blocks.forEach(block => {
                // 使用非贪婪正则精准提取内容
                const titleMatch = block.match(/^(.*?)\s*\*\*/);
                const descMatch = block.match(/Description:\s*([\s\S]*?)(?=Release Date:|$)/i);
                const dateMatch = block.match(/Release Date:\s*(.*?)(?=Links:|$)/i);
                const linkMatch = block.match(/Links:\s*(.*)/i);

                if (titleMatch && dateMatch) {
                    const title = titleMatch[1].trim();
                    const desc = descMatch ? descMatch[1].trim() : 'No description provided.';
                    const dateStr = dateMatch[1].trim();
                    const rawLink = linkMatch ? linkMatch[1].trim() : '';

                    // 链接智能简化逻辑 (aaa.com/a/b/c -> aaa.com)
                    let shortLink = "No Link";
                    let fullLink = "#";
                    if (rawLink && rawLink !== "(example.com)") {
                        // 确保带有 http 协议用于解析
                        fullLink = /^https?:\/\//i.test(rawLink) ? rawLink : 'https://' + rawLink;
                        try {
                            const urlObj = new URL(fullLink);
                            shortLink = urlObj.hostname.replace('www.', ''); // 提取纯净域名
                        } catch (e) {
                            shortLink = rawLink; // 若解析失败直接用原样
                        }
                    }

                    // 日期转换逻辑用于排序 (支持 DD/MM/YYYY 或 MM/DD/YYYY 或 YYYY/MM/DD)
                    let dateObj = new Date(dateStr);
                    if (isNaN(dateObj)) {
                        // 尝试暴力兼容 00/00/0000 格式 (假设是 DD/MM/YYYY)
                        const parts = dateStr.split('/');
                        if (parts.length === 3) dateObj = new Date(`${parts[2]}-${parts[1]}-${parts[0]}`);
                    }
                    const timestamp = isNaN(dateObj) ? 0 : dateObj.getTime();

                    projects.push({ title, desc, dateStr, shortLink, fullLink, timestamp });
                }
            });

            // 按照时间戳从新到老进行自动排序
            projects.sort((a, b) => b.timestamp - a.timestamp);

            renderUI(projects);
        }

        function renderUI(projects) {
            const gridContainer = document.getElementById("dynamic-projects-grid");
            const loader = document.getElementById("loading-state");
            
            loader.style.display = "none";
            gridContainer.classList.remove("hidden");

            projects.forEach((proj, index) => {
                const isNewest = index === 0;
                let htmlTemplate = '';

                // 构建卡片 HTML (注意：专门包裹了一层带有滚动监听属性的容器，用于实现模糊逻辑)
                if (isNewest) {
                    htmlTemplate = `
                        <div class="glass-card latest-project rounded-[2rem] p-8 md:p-12 md:col-span-2 flex flex-col md:flex-row gap-10 gs-reveal relative">
                            <div class="flex-1 w-full relative z-10 flex flex-col h-full">
                                <div class="flex items-center space-x-3 mb-6">
                                    <span class="px-3 py-1 rounded-full bg-accentPurple/20 border border-accentPurple/50 text-accentPurple text-[10px] font-bold uppercase tracking-widest flex items-center">
                                        <span class="w-2 h-2 rounded-full bg-accentPurple mr-2 animate-pulse"></span> Latest Update
                                    </span>
                                    <span class="text-sm font-mono text-textMuted border border-borderLight rounded px-2 py-1">${proj.dateStr}</span>
                                </div>
                                <h3 class="text-4xl md:text-5xl font-extrabold mb-6 text-white">${proj.title}</h3>
                                
                                <div class="relative w-full max-h-[140px] mb-8">
                                    <div class="scroll-box h-full overflow-y-auto hide-scroll text-textMuted text-base leading-relaxed pr-2">
                                        ${proj.desc}
                                    </div>
                                    <div class="blur-overlay"></div>
                                </div>

                                <div class="mt-auto pt-4">
                                    <a href="${proj.fullLink}" target="_blank" class="inline-flex items-center justify-center px-6 py-2.5 rounded-full border border-accentBlue/50 bg-accentBlue/10 hover:bg-accentBlue/20 text-accentBlue font-bold text-sm transition-colors">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg>
                                        ${proj.shortLink !== "No Link" ? proj.shortLink : "No external link"}
                                    </a>
                                </div>
                            </div>
                            <div class="flex-1 w-full p-6 bg-black/40 border border-borderLight rounded-xl flex flex-col justify-between hidden md:flex shrink-0 relative overflow-hidden">
                                <div class="absolute inset-0 bg-gradient-to-br from-accentPurple/10 to-transparent"></div>
                                <div class="font-mono text-[10px] text-textMuted uppercase opacity-50 absolute top-4 right-4">Core // Active</div>
                                <div class="text-accentPurple opacity-20"><svg class="w-32 h-32 absolute -bottom-10 -right-10" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0L1.5 6v12L12 24l10.5-6V6L12 0zm0 2.6L20 7.2v9.6L12 21.4 4 16.8V7.2L12 2.6zM12 5L6 8.4v7.2L12 19l6-3.4V8.4L12 5z"/></svg></div>
                            </div>
                        </div>
                    `;
                } else {
                    htmlTemplate = `
                        <div class="glass-card rounded-[2rem] p-8 gs-reveal flex flex-col relative h-[360px]">
                            <div class="flex justify-between items-start mb-6">
                                <h3 class="text-2xl font-bold text-white leading-tight w-2/3">${proj.title}</h3>
                                <span class="text-[11px] font-mono text-textMuted border border-borderLight rounded px-2 py-1 shrink-0 bg-black/20">${proj.dateStr}</span>
                            </div>
                            
                            <div class="relative w-full max-h-[120px] mb-8">
                                <div class="scroll-box h-full overflow-y-auto hide-scroll text-textMuted text-sm leading-relaxed pr-2">
                                    ${proj.desc}
                                </div>
                                <div class="blur-overlay"></div>
                            </div>

                            <div class="mt-auto pt-4 border-t border-borderLight/50">
                                <a href="${proj.fullLink}" target="_blank" class="text-xs uppercase tracking-widest text-textMuted hover:text-white transition flex items-center font-bold">
                                    <svg class="w-3 h-3 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                                    ${proj.shortLink !== "No Link" ? proj.shortLink : "No external link"}
                                </a>
                            </div>
                        </div>
                    `;
                }

                gridContainer.insertAdjacentHTML('beforeend', htmlTemplate);
            });

            // 初始化 GSAP 出现动画
            gsap.fromTo(".gs-reveal", { y: 40, opacity: 0 }, { y: 0, opacity: 1, duration: 1, stagger: 0.15, ease: "power3.out" });

            // 绑定模糊遮罩层的滚动逻辑
            bindScrollBlur();
        }

        // ==========================================
        // 核心微交互：滚动时自动取消底部模糊遮罩
        // ==========================================
        function bindScrollBlur() {
            const scrollBoxes = document.querySelectorAll('.scroll-box');
            
            scrollBoxes.forEach(box => {
                const overlay = box.nextElementSibling; // 获取同级的 .blur-overlay
                
                // 检查内容是否实际上溢出了。如果文字很短没溢出，直接隐藏遮罩。
                if (box.scrollHeight <= box.clientHeight) {
                    overlay.style.opacity = '0';
                }

                // 监听滚动事件
                box.addEventListener('scroll', () => {
                    // 触底或者往下滚了一段距离后，渐隐掉遮罩层
                    const isAtBottom = box.scrollHeight - box.scrollTop - box.clientHeight < 10;
                    if (box.scrollTop > 5 || isAtBottom) {
                        overlay.style.opacity = '0';
                    } else {
                        overlay.style.opacity = '1';
                    }
                });
            });
        }
    </script>
</body>
</html>
